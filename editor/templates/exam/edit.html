{% extends "editor.html" %}
{% load verbatim %}

{% block stylesheets %}
	{{ block.super }}
	<link href="{{ STATIC_URL }}css/exam/edit.css" type="text/css" rel="stylesheet" />
{% endblock stylesheets %}

{% block javascripts %}
    {{ block.super }}

	<!-- numbas -->
    <script src="{{ STATIC_URL }}js/numbas/R/R.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/numbas/R/en-gb.js" type="text/javascript"></script>
	<script src="{{ STATIC_URL }}js/numbas/numbas.js" type="text/javascript"></script>

    <!-- exam editor -->
    <script src="{{ STATIC_URL }}js/exam/edit.js" type="text/javascript"></script>

    <script type="text/javascript">
        {% autoescape off %}
        {% endautoescape %}
        (function() {
            if (!window.Editor) {
            	window.Editor = {};
            }
            var Editor = window.Editor;
			Editor.editable = {% if editable %}true{% else %}false{% endif %};
            {% autoescape off %}
        	Editor.examJSON = {{ exam_JSON }};
            Editor['themes'] = {{themes}};
            {% endautoescape %}
			Editor.previewURL = '{% url question_preview object.pk object.slug %}';
			Editor.previewWindow = '{% now "U" %}';
        })();
    </script>
{% endblock javascripts %}

{% block content %}
    {{ block.super }}


	{% if user == object.author or user.is_superuser %}
	
    {% else %}
	{% endif %}

	<div>
		<div id="controls">
			<div class="controlbox" id="author">
				Author: {{ object.author.first_name }} {{ object.author.last_name }} ({{ object.author.username }})
			</div>
			<div class="controlbox" id="admin">
				<a id="preview" data-bind="attr: {href: Editor.previewURL, target: Editor.previewWindow}" title="Run this exam in a new window (Ctrl+B)">Test Run</a>
				
				{% if editable %}
				<a id="delete" data-bind="click: deleteExam" href="{% url exam_delete object.pk object.slug %}" title="Delete this exam permanently but not the questions it uses">Delete
					<form action="{% url exam_delete object.pk object.slug %}" method="post">{% csrf_token %}
						<input type="submit" value="Submit" />
					</form>
				</a>
				{% endif %}

				{% if user.is_authenticated %}
					<a id="copy" href="{% url exam_copy object.pk object.slug %}" title="Create your own copy of this exam">Make a Copy</a>
				{% endif %}

				<span id="download">
					Download: 
					<a href="{% url exam_download object.pk object.slug %}">standalone .zip</a>,
					<a href="{% url exam_download object.pk object.slug %}?scorm">SCORM package</a>,
					<a href="{% url exam_source object.pk object.slug %}">source</a>
				</span>
			</div>
		</div>
		<div id="editor" data-bind="template: 'examTemplate'" role="form tree">Loading...</div>
	</div>
{% endblock content %}

{% block sidebar %}
{% endblock sidebar %}


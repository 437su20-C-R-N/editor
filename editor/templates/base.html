{% load sstatic %}
{% load analytical %}
{% load notifications_tags %}
{% load icon %}
{% notifications_unread as unread_notifications %}

<!DOCTYPE html>
<html>
    <head>
		{% analytical_head_top %}

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title>{% block title %}{{SITE_TITLE}}{% endblock %}</title>
		<!--[if lt IE 9]>
		<script>
		document.createElement('header');
		document.createElement('nav');
		document.createElement('section');
		document.createElement('article');
		document.createElement('aside');
		document.createElement('footer');
		document.createElement('hgroup');
		</script>
		<![endif]-->

		{% block head %}{% endblock %}

		{% block stylesheets %}
			<link href="{% sstatic 'bootstrap/css/bootstrap.min.css' %}" rel="stylesheet" media="screen">
			<link href="{% sstatic 'bootstrap/css/bootstrap-theme.min.css' %}" rel="stylesheet" media="screen">

			<link href="{% sstatic 'css/jquery.noty.css' %}" rel="stylesheet" type="text/css" />
			<link href="{% sstatic 'css/noty_theme_twitter.css' %}" rel="stylesheet" type="text/css" />
			<link href="{% sstatic 'css/jquery-ui.css' %}" rel="stylesheet" type="text/css" />

			<!--	<link href="{% sstatic 'css/main.css' %}" type="text/css" rel="stylesheet" /> -->
		{% endblock stylesheets %}

		{% analytical_head_bottom %}

    </head>
	<body>
		{% analytical_body_top %}

		<!-- get satisfaction -->
		<div id="getsat-widget-4240"></div>
		<script type="text/javascript" src="https://loader.engage.gsfn.us/loader.js"></script>
		<script type="text/javascript">
		if (typeof GSFN !== "undefined") { GSFN.loadWidget(4240,{"containerId":"getsat-widget-4240"}); }
		</script>

		<!-- main body -->
		{% block body %}
		<nav class="navbar navbar-default navbar-static-top">
		    <div class="container-fluid">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header">
			    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			    </button>
			    <a class="navbar-brand" href="#"><img src="https://numbas.mathcentre.ac.uk/static/images/numbas_logo.png?1348131388.0" height="100%"></a>
			</div>

			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

			    <form class="navbar-form navbar-left" role="search">
				<div class="form-group">
				    <div class="input-group">
					<div class="input-group-btn">
					    <select class="form-control">
						<option>All content</option>
						<option>Exams</option>
						<option>Questions</option>
					    </select>
					</div><!-- /btn-group -->
					<input type="text" class="form-control" id="top-search-bar" placeholder="Search by name or keyword">
					<div class="input-group-btn">
					    <button type="button" class="btn btn-default" aria-label="Search">
						<span class="glyphicon glyphicon-search" aria-hidden="true"></span>
					    </button>
					</div><!-- /btn-group -->
				    </div>
				</div>
			    </form>
			    <ul class="nav navbar-nav navbar-right">
				<li class="navbar-text">Hi, Bob!</li>
				<li>
				    <a role="button" class="dropdown-toggle" data-toggle="dropdown">
					<span class="glyphicon glyphicon-plus"></span> New <span class="caret"></span>
				    </a>
				    <ul class="dropdown-menu">
					<li><a href="#">Question</a></li>
					<li><a href="#">Exam</a></li>
				    </ul>
				</li>
				<li>
				    <a role="button" class="dropdown-toggle" data-toggle="dropdown">
					<span class="glyphicon glyphicon-bell"></span>
				    </a>
				    <ul class="dropdown-menu">
					<li><a href="#">Dude liked your question <b>Question 1</b></a></li>
					<li><a href="#">Questions</a></li>
					<li><a href="#">Exams</a></li>
					<li><a href="#">Themes</a></li>
					<li><a href="#">Extensions</a></li>
					<li role="separator" class="divider"></li>
					<li><a href="#"><b>Clear all notifications</b></a></li>
				    </ul>
				</li>
				<li>
				    <a role="button" class="dropdown-toggle" data-toggle="dropdown">
					<span class="glyphicon glyphicon-shopping-cart"></span>
				    </a>
				    <ul class="dropdown-menu basket">
					<li>
					    <a href="#">
						<button role="button" class="btn btn-xs btn-link btn-remove"><span class="glyphicon glyphicon-remove"></span></button>
						<b>Clear basket</b> 
					    </a>
					</li>
					<li role="separator" class="divider"></li>
					<li>
					    <a href="#">
						<button role="button" class="btn btn-xs btn-link btn-remove" title="Remove this question from your basket"><span class="glyphicon glyphicon-remove"></span></button>
						Question 1
					    </a> 
					</li>
					<li role="separator" class="divider"></li>
					<li>
					    <a href="#">
						<button role="button" class="btn btn-xs btn-link"><span class="glyphicon glyphicon-plus"></span></button>
						<b>Create an exam from these questions</b> 
					    </a>
					</li>
				    </ul>
				</li>
				<li class="dropdown">
				    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Your account <span class="caret"></span></a>
				    <ul class="dropdown-menu">
					<li><a href="#">Profile</a></li>
					<li><a href="#">Questions</a></li>
					<li><a href="#">Exams</a></li>
					<li><a href="#">Themes</a></li>
					<li><a href="#">Extensions</a></li>
					<li role="separator" class="divider"></li>
					<li><a href="#">Settings</a></li>
				    </ul>
				</li>
				<li><a class="bg-info" href="#">Help</a></li>
				<li><a href="#">Log out</a></li>
			    </ul>
			</div><!-- /.navbar-collapse -->
		    </div><!-- /.container-fluid -->
		</nav>

		<div id="content" role="main" class="container-fluid">
			{% if messages %}
			<ul class="messages alert">
				{% for message in messages %}
				<li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
				{% endfor %}
			</ul>
			{% endif %}
			{% block content %}
			{% endblock content %}
		</div>
		{% endblock body %}



		<div style="display:none" id="old-body">
        {% block oldbody %}
			<div id="main">
				<div id="header" class="row-fluid">
                    <div id="logo" role="banner" class="span4">
						<!-- logo -->
                        <div id="logo_text">
                            {% block logo_text %}
                            <a tabindex="1" alt="Numbas" href="/">
                                <img src="{% sstatic 'images/numbas_logo.png' %}"/>
                            </a>
                            {% endblock logo_text %}
                        </div>
                    </div>
                    <div id="session" class="span8">
						<!-- login message or profile link -->
                        {% if user.is_authenticated %}
						Hi, {{ user.get_short_name }}! 
                        <div id="notifications" class="top-dropdown btn-group {% if unread_notifications %}active{% endif %}">
                            <a class="btn dropdown-toggle {% if not unread_notifications %}disabled{% endif %}" data-toggle="dropdown" href="#" title="{{unread_notifications}} unread notification{{unread_notifications|pluralize}}">
                                {% icon "bell" %}
                            </a>
							<div class="counter noselect">{{unread_notifications}}</div>
							<ul class="dropdown-menu pull-right">
								{% include "notifications/list.html" %}
                            </ul>
                        </div>
                        {% with basket_size=user.userprofile.question_basket.count %}
                        <div id="question_basket" class="btn-group top-dropdown {% if basket_size %}active{% endif %}">
                            <a class="btn dropdown-toggle {% if not basket_size %}disabled{% endif %}" data-toggle="dropdown" href="#" title="{{basket_size}} question{{basket_size|pluralize}} in your basket">
                                {% icon "basket" %}
							</a>
							<div class="counter noselect">{{basket_size}}</div>
							<ul class="dropdown-menu pull-right">
								{% include "basket/list.html" %}
                            </ul>
                        </div>
                        {% endwith %}
						<span class="account-links"><a tabindex="2" href="{% url 'view_profile' user.pk %}">Your profile</a> ⋅ <a tabindex="2" href="{% url 'exam_search' %}?author={{user.get_full_name|urlencode}}">Your exams</a> ⋅ <a tabindex="2" href="{% url 'question_search' %}?author={{user.get_full_name|urlencode}}">Your questions</a>{% if CAN_LOGOUT %} ⋅ <a tabindex="2" id="logout" href="{% url 'logout' %}?next={{request.path|escape}}">Log out</a>{% endif %}</span>
                        {% else %}
                        <span class="account-links"><a tabindex="2" href="{% url 'login' %}?next={{request.path|escape}}">Log in</a>{% if ALLOW_REGISTRATION %} or <a tabindex="2" href="{% url 'registration_register' %}">create an account</a>{%endif%}.</span>
                        {% endif %}
					</div>
				</div>

                <div id="site_content">
                    {% block menubar %}
                        <ul id="menu" role="navigation" class="nav nav-tabs">
                            <li class="{% if navtab == "exams" %}active{% endif %}"><a href="{% url 'exam_index' %}">Exams</a></li>
							<li class="{% if navtab == "questions" %}active{% endif %}"><a href="{% url 'question_index' %}">Questions</a></li>   
							<li class="divider"></li>
							<li class="help"><a href="http://numbas-editor.readthedocs.org/" target="_blank">Documentation</a></li>
							<li class="help"><a href="http://numbas-editor.readthedocs.org/en/latest/#tutorials" target="_blank">Tutorials</a></li>
							<li class="{% if navtab == "home" %}active{% endif %}"><a href="{% url 'editor_index' %}">News</a></li>
                        </ul>
                        <!-- end #menubar -->
                    {% endblock menubar %}
                    <div id="content" role="main" class="container-fluid">
						{% if messages %}
						<ul class="messages alert">
							{% for message in messages %}
							<li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
							{% endfor %}
						</ul>
						{% endif %}
                    </div>
                    <!-- end #content -->
                </div>
                <!-- end #site_content -->
                <div id="footer" class="row-fluid">
					<div class="span3 offset3">
                        <a href="http://www.ncl.ac.uk/maths/">&copy; 2012 School of Mathematics &amp; Statistics, Newcastle University</a>
					</div>
					<div class="span3">
						Some icons from <a href="http://somerandomdude.com/work/iconic/">Iconic Icon Set</a> &copy; P.J. Onori, Licensed under Creative Commons Attribution-ShareAlike 3.0 Unported.
					</div>
                </div>
                <!-- end #footer -->
            </div>
            <!-- end #main -->
		{% endblock oldbody %}
		</div>

		{% block javascripts %}
		<!-- jQuery -->
			<script src="{% sstatic 'js/jquery.js' %}"></script>
			<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.13/jquery-ui.min.js" type="text/javascript"></script>

			<!-- bootstrap -->
			<script src="{% sstatic 'bootstrap/js/bootstrap.min.js' %}"></script>

			<!-- jQuery.oembed all -->
			<script type="text/javascript" src="{% sstatic 'js/jquery.oembed.js' %}"></script>

			<!-- knockout -->
			<script type="text/javascript" src="{% sstatic 'js/knockout.js' %}"></script>
			
			<!-- noty -->
			<script type="text/javascript" src="{% sstatic 'js/jquery.noty.js' %}"></script>

			<!-- moment.js - formats dates -->
			<script type="text/javascript" src="{% sstatic 'js/moment.js' %}"></script>

			<!-- mousetrap.js - handles keyboard shortcuts -->
			<script type="text/javascript" src="{% sstatic 'js/mousetrap.min.js' %}"></script>

			<!-- MathJax -->
			<script type="text/x-mathjax-config">
				MathJax.Hub.Config({
					tex2jax: {
						inlineMath: [['$','$'], ['\\(','\\)']],
						displayMath: [['\\[','\\]'], ['$$','$$']],
						processEscapes: true
					},
					"HTML-CSS": {
						mtextFontInherit: true
					},
                    skipStartupTypeset: {% block skipMathJaxStartup %}false{% endblock %}
				});
				MathJax.Hub.processSectionDelay = 0;
			</script>
			<script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

			<script src="{% sstatic 'js/es5-shim.js' %}" type="text/javascript"></script>

			<!-- SVG injector to make icons work in IE -->
			<img src="{% sstatic 'images/open-iconic.svg' %}" class="iconic-sprite" style="display:none;" />	
			<script src="{% sstatic 'js/svg-injector.min.js' %}"></script>

			<script>
				// Elements to inject
				var mySVGsToInject = document.querySelectorAll('.iconic-sprite');
	
				// Do the injection
				SVGInjector(mySVGsToInject);
			</script>

            <!-- editor -->
            <script src="{% sstatic 'js/main.js' %}" type="text/javascript"></script>
            <script src="{% sstatic 'js/editor.js' %}" type="text/javascript"></script>
		{% endblock %}

		{% analytical_body_bottom %}
    </body>
</html>

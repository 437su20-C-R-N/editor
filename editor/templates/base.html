{% load sstatic %}
{% load analytical %}
{% load notifications_tags %}
{% load icon %}
{% notifications_unread as unread_notifications %}

<!DOCTYPE html>
<html>
    <head>
        {% analytical_head_top %}

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <title>{% block title %}{{SITE_TITLE}}{% endblock %}</title>
        <!--[if lt IE 9]>
        <script>
        document.createElement('header');
        document.createElement('nav');
        document.createElement('section');
        document.createElement('article');
        document.createElement('aside');
        document.createElement('footer');
        document.createElement('hgroup');
        </script>
        <![endif]-->

        {% block head %}{% endblock %}

        {% block stylesheets %}
            <link href="{% sstatic 'bootstrap/css/bootstrap.min.css' %}" rel="stylesheet" media="screen">
            <!-- <link href="{% sstatic 'bootstrap/css/bootstrap-theme.min.css' %}" rel="stylesheet" media="screen"> -->

            <link href="{% sstatic 'css/jquery.noty.css' %}" rel="stylesheet" type="text/css" />
            <link href="{% sstatic 'css/noty_theme_twitter.css' %}" rel="stylesheet" type="text/css" />
            <link href="{% sstatic 'css/jquery-ui.css' %}" rel="stylesheet" type="text/css" />

			<link href="{% sstatic 'css/main.css' %}" type="text/css" rel="stylesheet" />
        {% endblock stylesheets %}

        {% analytical_head_bottom %}

    </head>
    <body>
        {% analytical_body_top %}

        <!-- get satisfaction -->
        <div id="getsat-widget-4240"></div>
        <script type="text/javascript" src="https://loader.engage.gsfn.us/loader.js"></script>
        <script type="text/javascript">
        if (typeof GSFN !== "undefined") { GSFN.loadWidget(4240,{"containerId":"getsat-widget-4240"}); }
        </script>

        <!-- main body -->
        {% block body %}
        <nav class="navbar navbar-default navbar-static-top">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
					<a class="navbar-brand" href="{% url 'editor_index' %}"><img id="numbas-logo" src="{% sstatic 'images/numbas_logo.png' %}"></a>
                </div>

                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

                    <form class="navbar-form navbar-left" role="search" method="get" action="{% url 'search' %}">
                        <div class="form-group">
                            <div class="input-group">
                                <input name="query" type="text" class="form-control" id="top-search-bar" placeholder="Search by name or keyword{% if in_project %} in this project{% endif %}" value="{{search_query}}"/>
                                <div class="input-group-btn">
                                    <button type="submit" class="btn btn-default" aria-label="Search">
                                        <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>

                    <ul id="session" class="nav navbar-nav navbar-right">
                        {% if user.is_authenticated %}
                            <li id="create-new-dropdown">
                                <a role="button" class="dropdown-toggle" data-toggle="dropdown">
                                <span class="glyphicon glyphicon-plus"></span> New <span class="caret"></span>
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a href="{% url 'question_new' %}">Question</a></li>
                                    <li><a href="{% url 'exam_new' %}">Exam</a></li>
                                </ul>
                            </li>
                            <li id="notifications" class="counter-icon {% if unread_notifications %}unread{% endif %}">
                                <a role="button" class="dropdown-toggle {% if not unread_notifications %}disabled{% endif %}" data-toggle="dropdown" title="{{unread_notifications}} unread notification{{unread_notifications|pluralize}}">
                                    <span class="glyphicon glyphicon-bell"></span>
                                </a>
                                <span class="counter noselect">{{unread_notifications}}</span>
                                <ul class="dropdown-menu">
                                    {% include "notifications/list.html" %}
                                </ul>
                            </li>
                            {% with basket_size=user.userprofile.question_basket.count %}
                            <li id="question_basket" class="counter-icon {% if basket_size %}nonempty{% endif %}">
                                    <a role="button" class="dropdown-toggle {% if not basket_size %}disabled{% endif %}" data-toggle="dropdown" title="{{basket_size}} question{{basket_size|pluralize}} in your basket">
                                        <span class="glyphicon glyphicon-shopping-cart"></span>
                                    </a>
                                    <span class="counter noselect">{{basket_size}}</span>
                                    <ul class="dropdown-menu basket">
                                        {% include "basket/list.html" %}
                                    </ul>
                                </li>
                            {% endwith %}
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">{{user.get_full_name}}<span class="caret"></span></a>
                                <ul class="dropdown-menu">
                                <li><a tabindex="2" href="{% url 'view_profile' user.pk %}">Profile</a></li>
                                <li role="separator" class="divider"></li>
                                <li><a tabindex="2" href="{% url 'theme_list' %}">Themes</a></li>
                                <li><a tabindex="2" href="{% url 'extension_list' %}">Extensions</a></li>
                                <li role="separator" class="divider"></li>
                                <li><a tabindex="2" href="{% url 'edit_profile' %}">Settings</a></li>
                                {% if CAN_LOGOUT %}
                                <li><a tabindex="2" href="{% url 'logout' %}?next={{request.path|escape}}">Log out</a></li>
                                {% endif %}
                                </ul>
                            </li>
                            <li>
                                <a class="bg-info" href="http://numbas-editor.readthedocs.org/" target="_blank">Help</a>
                            </li>
                        {% else %}
                            <li>
                                <a tabindex="2" href="{% url 'login' %}?next={{request.path|escape}}">Log in</a>
                            </li>
                            {% if ALLOW_REGISTRATION %}
                            <li>
                                <a tabindex="2" href="{% url 'registration_register' %}">Create an account</a>
                            </li>
                            {%endif%}
                        {% endif %}
                    </ul>
                </div>
            </div>
        </nav>

        <div id="content" role="main" class="container-fluid">
            {% if messages %}
            <ul class="messages alert">
                {% for message in messages %}
                <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
                {% endfor %}
            </ul>
            {% endif %}
            {% block content %}
            {% endblock content %}
        </div>
        {% endblock body %}

        {% block javascripts %}
        <!-- jQuery -->
            <script src="{% sstatic 'js/jquery.js' %}"></script>
            <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.13/jquery-ui.min.js" type="text/javascript"></script>

            <!-- bootstrap -->
            <script src="{% sstatic 'bootstrap/js/bootstrap.min.js' %}"></script>

            <!-- jQuery.oembed all -->
            <script type="text/javascript" src="{% sstatic 'js/jquery.oembed.js' %}"></script>

            <!-- knockout -->
            <script type="text/javascript" src="{% sstatic 'js/knockout.js' %}"></script>
            
            <!-- noty -->
            <script type="text/javascript" src="{% sstatic 'js/jquery.noty.js' %}"></script>

            <!-- moment.js - formats dates -->
            <script type="text/javascript" src="{% sstatic 'js/moment.js' %}"></script>

            <!-- mousetrap.js - handles keyboard shortcuts -->
            <script type="text/javascript" src="{% sstatic 'js/mousetrap.min.js' %}"></script>

            <!-- MathJax -->
            <script type="text/x-mathjax-config">
                MathJax.Hub.Config({
                    tex2jax: {
                        inlineMath: [['$','$'], ['\\(','\\)']],
                        displayMath: [['\\[','\\]'], ['$$','$$']],
                        processEscapes: true
                    },
                    "HTML-CSS": {
                        mtextFontInherit: true
                    },
                    skipStartupTypeset: {% block skipMathJaxStartup %}false{% endblock %}
                });
                MathJax.Hub.processSectionDelay = 0;
            </script>
            <script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

            <script src="{% sstatic 'js/es5-shim.js' %}" type="text/javascript"></script>

            <!-- SVG injector to make icons work in IE -->
            <img src="{% sstatic 'images/open-iconic.svg' %}" class="iconic-sprite" style="display:none;" />    
            <script src="{% sstatic 'js/svg-injector.min.js' %}"></script>

            <script>
                // Elements to inject
                var mySVGsToInject = document.querySelectorAll('.iconic-sprite');
    
                // Do the injection
                SVGInjector(mySVGsToInject);
            </script>

            <!-- editor -->
            <script src="{% sstatic 'js/main.js' %}" type="text/javascript"></script>
            <script src="{% sstatic 'js/editor.js' %}" type="text/javascript"></script>
        {% endblock %}

        {% analytical_body_bottom %}
    </body>
</html>

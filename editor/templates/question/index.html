{% extends "layout.html" %}

{% block content %}

	{% if user.is_authenticated %}
		<button id="newQuestion" href="{% url question_new %}">New question</button>
	
		<form action="{% url question_new %}" method="post" id="newQuestionForm">
			{% csrf_token %}
			Name: <input type="text" name="name" maxlength="200" />
	        <input type="submit" value="Create" />
	        <input type="hidden" name="author" value="{{user.id}}" />
		</form>
	
		<form action="{% url question_upload %}" method="post" id="uploadForm" enctype="multipart/form-data">
            {% csrf_token %}
            <button id="uploadButton">Upload a question</button>
            <div class="upload">
                <input type="file" name="file" value="yo"/>
            </div>
		</form>
	{% endif %}

    <div>
        <div class="searchBox">
            <label for="questionsearch">Search for questions: </label>
            <input type="text" name="questionsearch" class="search" data-bind="
                value: questionSearch, 
                valueUpdate: 'afterkeydown',
                css: {loading: searching()}
            "/>

            <label for="questionsearchbyauthor"> by author: </label>
            <input type="text" class="search" size="30" data-bind="
                value: questionSearchByAuthor,
                valueUpdate: 'afterkeydown',
                autocomplete: '{% url user_search %}', 
                autocompleteCallback: function(user) { return {label: user.username+' ('+user.name+')', value: user.username} }
            "/>

               <table  id="question-list">
                <thead>
                    <th>Name</th>
                    <th>Author</th>
                    <th></th>
                </thead>
                <tbody  id="question-list" class="results editlist big" data-bind="
                    template: {
                        name: 'questionResult',
                        foreach: questionSearchResults
                    }
                ">
                </tbody>
            </table>
        </div>
    </div>
    
    <script type="text/x-jquery-tmpl" id="questionResult">
        <tr class="question">
            <td><span class="handle"></span>
            <a data-bind="attr: {href: url}, text: name"></a>
            </td>
            <td><span data-bind="text: author"></span></td>
            <td>
    	        <a class="admin preview" data-bind="attr: {href: url+'preview/'}" target="_blank" title="Test run"></a>
	            <a class="admin copy" data-bind="attr: {href: url+'copy/'}" title="Make a copy"></a>
                <a class="admin delete" data-bind="visible: canEdit, attr: {href: url+'delete/'}" title="Delete"></a>
            </td>
        </tr>
    </script>

{% endblock content %}

{% block javascripts %}
    {{block.super}}
    <script type="text/javascript" src="{{ STATIC_URL }}js/question/index.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.tablesorter.js"></script>
{% endblock javascripts %}

{% block stylesheets %}
	{{ block.super }}
    <link href="{{ STATIC_URL }}css/index.css" type="text/css" rel="stylesheet" />
    <link href="{{ STATIC_URL }}css/question/index.css" type="text/css" rel="stylesheet" />
{% endblock stylesheets %}

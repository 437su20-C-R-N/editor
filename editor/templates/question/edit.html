{% extends "editor.html" %}
{% load verbatim %}

{% block javascripts %}
    {{ block.super }}

	<!-- numbas -->
	<script src="{{ STATIC_URL }}js/numbas/R/R.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/numbas/R/en-gb.js" type="text/javascript"></script>
	<script src="{{ STATIC_URL }}js/numbas/numbas.js" type="text/javascript"></script>

	<!-- question editor -->
    <script src="{{ STATIC_URL }}js/question/edit.js" type="text/javascript"></script>

    <script type="text/javascript">
        (function() {
            if (!window.Editor) {
                window.Editor = {};
            }
            var Editor = window.Editor;
			Editor.questionJSON = {% autoescape off %}{{question.as_json}}{% endautoescape %};
			Editor.editable = {% if editable %}true{% else %}false{% endif %};

			Editor.numbasExtensions = {% autoescape off %}{{extensions}}{% endautoescape %};
        })();
    </script>
{% endblock javascripts %}
{% block stylesheets %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/question/edit.css"/>
{% endblock stylesheets %}
	
{% block content %}
	{{block.super }}

    {% block property_templates %}{% endblock %}

	<div id="question" class="{% if not editable %}nonedit{% endif %}">
		<div id="controls">
			{% block controls %}
    			<div id="editable_message">{% block editable_message %}{% endblock %}</div>
				<div class="controlbox" id="author">
					Author: {{ object.author.first_name }} {{ object.author.last_name }} ({{ object.author.username }})
				</div>
				<div class="controlbox" id="buttons">
					Download: 
					<a href="{% url question_download object.pk object.slug %}">standalone .zip</a>,
					<a href="{% url question_download object.pk object.slug %}?scorm">SCORM package</a>,
					<a href="{% url question_source object.pk object.slug %}">source</a>
				</div>
                <div class="controlbox" id="admin">
                    <a id="preview" href="{% url question_preview object.pk object.slug %}" target="{% now "U" %}">Test Run</a>
					
					{% if editable %}
                    <a id="delete" data-bind="click: deleteQuestion" href="{% url question_delete object.pk object.slug %}">Delete
                        <form action="{% url question_delete object.pk object.slug %}" method="post">{% csrf_token %}
                            <input type="submit" value="Submit" />
                        </form>
                    </a>

					{% endif %}

					{% if user.is_authenticated %}
						<a id="copy" href="{% url question_copy object.pk object.slug %}">Make a Copy</a>
					{% endif %}
				</div>
			{% endblock controls %}
		</div>
		<div id="editor" data-bind="template: 'questionTemplate'">Loading...</div>
	</div>

{% endblock content %}
